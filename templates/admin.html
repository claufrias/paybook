<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî¥ RedCajeros - Panel Admin</title>
    
    <!-- Bootstrap 5 Dark -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-dark-5@1.1.3/dist/css/bootstrap-night.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Nuestro CSS personalizado -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <style>
        .admin-header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-bottom: 3px solid #ff416c;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        .admin-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .admin-card:hover {
            transform: translateY(-5px);
            border-color: #ff416c;
            box-shadow: 0 10px 20px rgba(255, 65, 108, 0.2);
        }
        
        .pago-item {
            border-left: 4px solid #ffa726;
            padding-left: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .pago-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-left-color: #2ecc71;
        }
        
        .pago-pendiente {
            border-left-color: #ffa726;
        }
        
        .pago-verificado {
            border-left-color: #2ecc71;
        }
        
        .pago-rechazado {
            border-left-color: #e74c3c;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .quick-action-btn {
            flex: 1;
            min-width: 200px;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .quick-action-btn:hover {
            background: rgba(255, 65, 108, 0.2);
            border-color: #ff416c;
            transform: translateY(-2px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #bbb;
            font-size: 0.9rem;
        }
        
        .admin-table {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .admin-table th {
            background: rgba(255, 65, 108, 0.2);
            border: none;
            font-weight: 600;
            color: #fff;
        }
        
        .admin-table td {
            border-color: rgba(255, 255, 255, 0.1);
            vertical-align: middle;
        }
        
        .badge-admin {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-trial {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-active {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .badge-expired {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .whatsapp-link:hover {
            color: #128C7E;
            text-decoration: underline;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-verify {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .btn-reject {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }
        
        .btn-whatsapp {
            background: linear-gradient(45deg, #25D366, #128C7E);
            color: white;
        }
        
        .btn-edit {
            background: linear-gradient(45deg, #3498db, #2980b9);
            color: white;
        }
        
        .action-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="story-circle mb-4 pulse" style="width: 80px; height: 80px; border: none; background: linear-gradient(45deg, #ff416c, #ff4b2b);">
                <i class="fas fa-user-shield fa-2x"></i>
            </div>
            <h4 class="gradient-text-red mb-3">Panel Admin</h4>
            <p class="text-muted">Cargando datos del sistema...</p>
        </div>
    </div>

    <!-- Admin Header -->
    <div class="admin-header">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="gradient-text-red mb-2">
                        <i class="fas fa-user-shield me-2"></i>Panel de Administraci√≥n
                    </h1>
                    <p class="text-muted mb-0">Gesti√≥n completa del sistema RedCajeros</p>
                </div>
                <div class="text-end">
                    <button class="btn btn-ig-outline me-2" onclick="window.location.href='/dashboard'">
                        <i class="fas fa-arrow-left me-2"></i> Volver al Dashboard
                    </button>
                    <button class="btn btn-ig-red" onclick="cargarDatosAdmin()">
                        <i class="fas fa-sync-alt me-2"></i> Actualizar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Alert Container -->
        <div id="alertContainer" class="mb-3"></div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <div class="quick-action-btn" onclick="mostrarPagosPendientes()">
                <i class="fas fa-clock fa-2x mb-2"></i>
                <div>Pagos Pendientes</div>
                <small class="text-muted" id="pendientesCount">0</small>
            </div>
            
            <div class="quick-action-btn" onclick="mostrarUsuarios()">
                <i class="fas fa-users fa-2x mb-2"></i>
                <div>Usuarios Activos</div>
                <small class="text-muted" id="usuariosCount">0</small>
            </div>
            
            <div class="quick-action-btn" onclick="mostrarEstadisticas()">
                <i class="fas fa-chart-bar fa-2x mb-2"></i>
                <div>Estad√≠sticas</div>
                <small class="text-muted">Ver reportes</small>
            </div>
            
            <div class="quick-action-btn" onclick="mostrarConfiguracion()">
                <i class="fas fa-cog fa-2x mb-2"></i>
                <div>Configuraci√≥n</div>
                <small class="text-muted">Ajustes del sistema</small>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-box">
                <div class="stat-label">INGRESOS ESTE MES</div>
                <div class="stat-number" id="ingresosMes">$0</div>
                <small class="text-muted">Total verificados</small>
            </div>
            
            <div class="stat-box">
                <div class="stat-label">USUARIOS TOTALES</div>
                <div class="stat-number" id="usuariosTotales">0</div>
                <small class="text-muted">Registrados en el sistema</small>
            </div>
            
            <div class="stat-box">
                <div class="stat-label">USUARIOS ACTIVOS</div>
                <div class="stat-number" id="usuariosActivos">0</div>
                <small class="text-muted">Con suscripci√≥n vigente</small>
            </div>
            
            <div class="stat-box">
                <div class="stat-label">EN TRIAL</div>
                <div class="stat-number" id="usuariosTrial">0</div>
                <small class="text-muted">Per√≠odo de prueba</small>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <ul class="nav nav-tabs mb-4" id="adminTabs">
            <li class="nav-item">
                <button class="nav-link active" onclick="mostrarTab('pagos')">
                    <i class="fas fa-money-bill-wave me-2"></i>Pagos Pendientes
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="mostrarTab('usuarios')">
                    <i class="fas fa-users me-2"></i>Usuarios
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link" onclick="mostrarTab('config')">
                    <i class="fas fa-cog me-2"></i>Configuraci√≥n
                </button>
            </li>
        </ul>

        <!-- Tabs Content -->
        <div id="tabContent">
            <!-- Pagos Pendientes Tab (default) -->
            <div id="tabPagos">
                <div class="ig-card">
                    <div class="ig-card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 gradient-text-red">
                            <i class="fas fa-clock me-2"></i>Pagos Pendientes de Verificaci√≥n
                        </h5>
                        <small class="text-muted" id="pagosPendientesCount">0 pagos por verificar</small>
                    </div>
                    <div class="ig-card-body">
                        <div id="pagosPendientesList">
                            <div class="text-center py-5">
                                <div class="mb-3">
                                    <i class="fas fa-spinner fa-spin fa-2x"></i>
                                </div>
                                <h6>Cargando pagos pendientes...</h6>
                                <small class="text-muted">Por favor espere</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Usuarios Tab (hidden by default) -->
            <div id="tabUsuarios" class="d-none">
                <div class="ig-card">
                    <div class="ig-card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 gradient-text-red">
                            <i class="fas fa-users me-2"></i>Usuarios Registrados
                        </h5>
                        <button class="btn btn-ig-red btn-sm" onclick="exportarUsuariosCSV()">
                            <i class="fas fa-download me-2"></i> Exportar CSV
                        </button>
                    </div>
                    <div class="ig-card-body">
                        <div class="table-responsive">
                            <table class="table admin-table">
                                <thead>
                                    <tr>
                                        <th>Usuario</th>
                                        <th>Email</th>
                                        <th>Plan</th>
                                        <th>Expiraci√≥n</th>
                                        <th>Estado</th>
                                        <th>Registro</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="usuariosList">
                                    <tr>
                                        <td colspan="7" class="text-center py-5">
                                            <div class="mb-3">
                                                <i class="fas fa-spinner fa-spin fa-2x"></i>
                                            </div>
                                            <h6>Cargando usuarios...</h6>
                                            <small class="text-muted">Por favor espere</small>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuraci√≥n Tab (hidden by default) -->
            <div id="tabConfig" class="d-none">
                <div class="ig-card">
                    <div class="ig-card-header">
                        <h5 class="mb-0 gradient-text-red">
                            <i class="fas fa-cog me-2"></i>Configuraci√≥n del Sistema
                        </h5>
                    </div>
                    <div class="ig-card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="ig-card">
                                    <div class="ig-card-header">
                                        <h6 class="mb-0">Informaci√≥n del Admin</h6>
                                    </div>
                                    <div class="ig-card-body">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Email de Admin</label>
                                            <input type="email" id="configAdminEmail" class="form-control form-control-ig" 
                                                   value="admin@redcajeros.com" readonly>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label text-muted">WhatsApp para Pagos</label>
                                            <input type="text" id="configAdminWhatsapp" class="form-control form-control-ig" 
                                                   placeholder="584121234567">
                                            <small class="text-muted">N√∫mero donde recibir√°s comprobantes</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="ig-card">
                                    <div class="ig-card-header">
                                        <h6 class="mb-0">Datos Bancarios</h6>
                                    </div>
                                    <div class="ig-card-body">
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Nombre del Banco</label>
                                            <input type="text" id="configBancoNombre" class="form-control form-control-ig" 
                                                   placeholder="Tu Banco">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label text-muted">N√∫mero de Cuenta</label>
                                            <input type="text" id="configBancoCuenta" class="form-control form-control-ig" 
                                                   placeholder="0102-1234-5678-9012">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label text-muted">Nombre del Titular</label>
                                            <input type="text" id="configBancoTitular" class="form-control form-control-ig" 
                                                   placeholder="Tu Nombre">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <div class="ig-card">
                                    <div class="ig-card-header">
                                        <h6 class="mb-0">Precios de Planes</h6>
                                    </div>
                                    <div class="ig-card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label text-muted">Plan B√°sico (USD/mes)</label>
                                                    <input type="number" id="configPrecioBasico" class="form-control form-control-ig" 
                                                           step="0.01" value="9.99">
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="mb-3">
                                                    <label class="form-label text-muted">Plan Premium (USD/mes)</label>
                                                    <input type="number" id="configPrecioPremium" class="form-control form-control-ig" 
                                                           step="0.01" value="19.99">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-12">
                                <button class="btn btn-ig-red w-100" onclick="guardarConfiguracion()">
                                    <i class="fas fa-save me-2"></i> Guardar Configuraci√≥n
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="py-3 mt-5 border-top border-dark">
        <div class="container text-center">
            <small class="text-muted">
                <i class="fas fa-user-shield me-1"></i> RedCajeros Admin Panel | 
                <i class="fas fa-code ms-3 me-1"></i> Sistema Multi-Usuario |
                <i class="fas fa-clock ms-3 me-1"></i> <span id="lastUpdateAdmin">--:--</span>
            </small>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Admin JavaScript -->
    <script>
        // Variables globales
        let adminData = null;
        let pagosPendientes = [];
        let usuariosList = [];
        
        // Mostrar/ocultar tabs
        function mostrarTab(tabName) {
            // Ocultar todos los tabs
            document.getElementById('tabPagos').classList.add('d-none');
            document.getElementById('tabUsuarios').classList.add('d-none');
            document.getElementById('tabConfig').classList.add('d-none');
            
            // Remover active de todos los botones
            document.querySelectorAll('#adminTabs .nav-link').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Mostrar tab seleccionado
            document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.remove('d-none');
            
            // Activar bot√≥n correspondiente
            document.querySelector(`#adminTabs button[onclick="mostrarTab('${tabName}')"]`).classList.add('active');
            
            // Cargar datos espec√≠ficos del tab
            if (tabName === 'pagos') {
                cargarPagosPendientes();
            } else if (tabName === 'usuarios') {
                cargarUsuarios();
            } else if (tabName === 'config') {
                cargarConfiguracion();
            }
        }
        
        // Cargar datos del admin
        async function cargarUsuarioAdmin() {
            try {
                const response = await fetch('/api/user/info');
                if (!response.ok) throw new Error('Error de autenticaci√≥n');
                
                const data = await response.json();
                if (data.success && data.user.es_admin) {
                    adminData = data.user;
                    cargarDatosAdmin();
                } else {
                    window.location.href = '/dashboard';
                }
            } catch (error) {
                window.location.href = '/';
            }
        }
        
        // Cargar datos generales del admin
        async function cargarDatosAdmin() {
            mostrarLoading(true);
            
            try {
                // Cargar estad√≠sticas
                const statsResponse = await fetch('/api/admin/estadisticas');
                const statsData = await statsResponse.json();
                
                if (statsData.success) {
                    actualizarEstadisticas(statsData.data);
                }
                
                // Cargar pagos pendientes
                await cargarPagosPendientes();
                
                // Actualizar timestamp
                document.getElementById('lastUpdateAdmin').textContent = 
                    `Actualizado: ${new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}`;
                
            } catch (error) {
                mostrarAlertaAdmin('Error', 'Error cargando datos del sistema', 'error');
            } finally {
                mostrarLoading(false);
            }
        }
        
        function actualizarEstadisticas(data) {
            // Actualizar stats grid
            document.getElementById('ingresosMes').textContent = `$${data.pagos.este_mes_monto.toFixed(2)}`;
            document.getElementById('usuariosTotales').textContent = data.usuarios.total;
            document.getElementById('usuariosActivos').textContent = data.usuarios.activos;
            document.getElementById('usuariosTrial').textContent = data.usuarios.trial;
            
            // Actualizar quick actions
            document.getElementById('pendientesCount').textContent = data.pagos.pendientes;
            document.getElementById('usuariosCount').textContent = data.usuarios.activos;
        }
        
        // Cargar pagos pendientes
        async function cargarPagosPendientes() {
            try {
                const response = await fetch('/api/admin/pagos/pendientes');
                const data = await response.json();
                
                if (data.success) {
                    pagosPendientes = data.data;
                    renderPagosPendientes();
                }
            } catch (error) {
                console.error('Error cargando pagos pendientes:', error);
            }
        }
        
        function renderPagosPendientes() {
            const container = document.getElementById('pagosPendientesList');
            
            if (!pagosPendientes || pagosPendientes.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <div class="mb-3">
                            <i class="fas fa-check-circle fa-3x text-success"></i>
                        </div>
                        <h6>¬°Todo al d√≠a!</h6>
                        <small class="text-muted">No hay pagos pendientes de verificaci√≥n</small>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            pagosPendientes.forEach(pago => {
                const fechaSolicitud = new Date(pago.fecha_solicitud);
                const hora = fechaSolicitud.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
                const fecha = fechaSolicitud.toLocaleDateString('es-ES');
                
                html += `
                    <div class="pago-item pago-pendiente mb-3 p-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="user-avatar">
                                        ${pago.usuario.nombre ? pago.usuario.nombre.charAt(0).toUpperCase() : 'U'}
                                    </div>
                                    <div>
                                        <h6 class="mb-0">${pago.usuario.nombre || 'Usuario'}</h6>
                                        <small class="text-muted">${pago.usuario.email}</small>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-3">
                                        <small class="text-muted">C√≥digo:</small>
                                        <div class="fw-bold font-monospace">${pago.codigo}</div>
                                    </div>
                                    <div class="col-md-3">
                                        <small class="text-muted">Plan:</small>
                                        <div class="fw-bold">${pago.plan.toUpperCase()}</div>
                                    </div>
                                    <div class="col-md-3">
                                        <small class="text-muted">Monto:</small>
                                        <div class="fw-bold text-success">$${pago.monto.toFixed(2)}</div>
                                    </div>
                                    <div class="col-md-3">
                                        <small class="text-muted">Solicitado:</small>
                                        <div class="fw-bold">${fecha} ${hora}</div>
                                    </div>
                                </div>
                                
                                ${pago.usuario.telefono ? `
                                <div class="mt-2">
                                    <small class="text-muted">Contacto:</small>
                                    <div>
                                        <a href="https://wa.me/${pago.usuario.telefono}" 
                                           class="whatsapp-link" target="_blank">
                                            <i class="fab fa-whatsapp me-1"></i>
                                            ${pago.usuario.telefono}
                                        </a>
                                    </div>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div class="action-buttons ms-3">
                                <button class="action-btn btn-verify" 
                                        onclick="verificarPago('${pago.codigo}')"
                                        title="Verificar pago">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="action-btn btn-reject" 
                                        onclick="rechazarPago('${pago.codigo}')"
                                        title="Rechazar pago">
                                    <i class="fas fa-times"></i>
                                </button>
                                ${pago.usuario.telefono ? `
                                <button class="action-btn btn-whatsapp" 
                                        onclick="contactarWhatsApp('${pago.usuario.telefono}', '${pago.codigo}')"
                                        title="Contactar por WhatsApp">
                                    <i class="fab fa-whatsapp"></i>
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            document.getElementById('pagosPendientesCount').textContent = 
                `${pagosPendientes.length} pagos por verificar`;
        }
        
        // Cargar usuarios
        async function cargarUsuarios() {
            try {
                // En una implementaci√≥n real, tendr√≠as una API para esto
                // Por ahora usaremos una simulaci√≥n
                const response = await fetch('/api/admin/usuarios'); // Esta ruta habr√≠a que crearla
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        usuariosList = data.data;
                        renderUsuarios();
                    }
                }
            } catch (error) {
                console.error('Error cargando usuarios:', error);
                // Mostrar datos de ejemplo para demostraci√≥n
                mostrarUsuariosDemo();
            }
        }
        
        function mostrarUsuariosDemo() {
            const container = document.getElementById('usuariosList');
            container.innerHTML = `
                <tr>
                    <td colspan="7" class="text-center py-5">
                        <div class="mb-3">
                            <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                        </div>
                        <h6>Funci√≥n en desarrollo</h6>
                        <small class="text-muted">La gesti√≥n completa de usuarios estar√° disponible en la pr√≥xima actualizaci√≥n</small>
                        <div class="mt-3">
                            <button class="btn btn-ig-red btn-sm" onclick="cargarDatosAdmin()">
                                <i class="fas fa-sync-alt me-2"></i> Actualizar
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }
        
        // Cargar configuraci√≥n
        async function cargarConfiguracion() {
            try {
                const response = await fetch('/api/configuracion');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        // Llenar campos con valores actuales
                        // Esto es un ejemplo - necesitar√≠as crear la API correspondiente
                    }
                }
            } catch (error) {
                console.error('Error cargando configuraci√≥n:', error);
            }
        }
        
        // Funciones de acciones
        async function verificarPago(codigo) {
            if (!confirm(`¬øVerificar el pago ${codigo}?\n\nEl usuario recibir√° 30 d√≠as adicionales de servicio.`)) {
                return;
            }
            
            mostrarLoading(true);
            
            try {
                const response = await fetch(`/api/admin/pagos/verificar/${codigo}`, {
                    method: 'POST'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    mostrarAlertaAdmin('‚úÖ Pago Verificado', data.message, 'success');
                    await cargarDatosAdmin();
                } else {
                    mostrarAlertaAdmin('Error', data.error, 'error');
                }
            } catch (error) {
                mostrarAlertaAdmin('Error', 'Error de conexi√≥n', 'error');
            } finally {
                mostrarLoading(false);
            }
        }
        
        async function rechazarPago(codigo) {
            const motivo = prompt(`¬øRechazar el pago ${codigo}?\n\nIngresa el motivo del rechazo:`);
            if (motivo === null) return;
            
            mostrarLoading(true);
            
            try {
                const response = await fetch(`/api/admin/pagos/rechazar/${codigo}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ motivo: motivo })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    mostrarAlertaAdmin('‚ùå Pago Rechazado', data.message, 'warning');
                    await cargarDatosAdmin();
                } else {
                    mostrarAlertaAdmin('Error', data.error, 'error');
                }
            } catch (error) {
                mostrarAlertaAdmin('Error', 'Error de conexi√≥n', 'error');
            } finally {
                mostrarLoading(false);
            }
        }
        
        function contactarWhatsApp(telefono, codigo) {
            const mensaje = `Hola! üëã\n\nSoy el administrador de RedCajeros.\n\nHe visto tu solicitud de pago con c√≥digo:\n*${codigo}*\n\n¬øNecesitas ayuda con el proceso?\n\nSaludos!`;
            const url = `https://wa.me/${telefono}?text=${encodeURIComponent(mensaje)}`;
            window.open(url, '_blank');
        }
        
        function guardarConfiguracion() {
            mostrarLoading(true);
            
            // Simular guardado
            setTimeout(() => {
                mostrarAlertaAdmin('‚úÖ Configuraci√≥n Guardada', 'Los cambios se han aplicado correctamente', 'success');
                mostrarLoading(false);
            }, 1000);
        }
        
        function exportarUsuariosCSV() {
            // Simular exportaci√≥n
            mostrarAlertaAdmin('‚è≥ Exportando...', 'La exportaci√≥n de usuarios comenzar√° pronto', 'info');
        }
        
        // Funciones de utilidad
        function mostrarLoading(mostrar = true) {
            const overlay = document.getElementById('loadingOverlay');
            if (!overlay) return;
            
            if (mostrar) {
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                overlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }
        
        function mostrarAlertaAdmin(titulo, mensaje, tipo = 'info') {
            const alerta = document.createElement('div');
            alerta.className = `alert-ig ${tipo === 'error' ? 'alert-ig-error' : tipo === 'success' ? 'alert-ig-success' : 'alert-ig-info'} fade-in`;
            alerta.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas ${tipo === 'success' ? 'fa-check-circle' : tipo === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'} fa-lg me-3"></i>
                    <div class="flex-grow-1">
                        <h6 class="mb-1 fw-bold">${titulo}</h6>
                        <small>${mensaje}</small>
                    </div>
                    <button type="button" class="btn-close btn-close-white ms-2" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            const container = document.getElementById('alertContainer');
            if (container) {
                container.prepend(alerta);
                
                setTimeout(() => {
                    if (alerta.parentNode) alerta.remove();
                }, 5000);
            }
        }
        
        // Shortcuts de teclado
        document.addEventListener('keydown', function(event) {
            // F5 para actualizar
            if (event.key === 'F5') {
                event.preventDefault();
                cargarDatosAdmin();
            }
            
            // Ctrl+R para actualizar
            if ((event.ctrlKey || event.metaKey) && event.key === 'r') {
                event.preventDefault();
                cargarDatosAdmin();
            }
            
            // Escape para cancelar loading
            if (event.key === 'Escape') {
                mostrarLoading(false);
            }
        });
        
        // Inicializar panel admin
        document.addEventListener('DOMContentLoaded', function() {
            cargarUsuarioAdmin();
            
            // Auto-actualizar cada 60 segundos
            setInterval(() => {
                if (!document.hidden) {
                    cargarPagosPendientes();
                    document.getElementById('lastUpdateAdmin').textContent = 
                        `Actualizado: ${new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' })}`;
                }
            }, 60000);
        });
    </script>
</body>
</html>